var RBX=function(){var _init=function(){_tooltips(),_dissmissSiteAlert(),_reloadPage(),_modalFragment(),_submitModalChanges(),_modalAsyncCall(),_improveRepositoryTypeSelection(),_newBoxForm(),_navTabs(),_activateTabFromHash(),_addParamChoices(),_loadParamEdit(),_submitParamEdit(),_confirmAction()},_tooltips=function(){$(window).on("resize",function(){!window.matchMedia||window.matchMedia("(min-width: 979px)").matches?$('a[rel="tooltip"]').tooltip({placement:"bottom"}):$('a[rel="tooltip"]').tooltip("destroy")}).trigger("resize"),$("form i").tooltip(),$(".media-heading i").tooltip({placement:"right"})},_dissmissSiteAlert=function(){$(".site-alert button.close").on("click",function(){$(this).parent().parent().remove()})},_modalFragment=function(){$(".modal-fragment").on("click",function(){var target=$(this).attr("data-target");return $(target).modal({keyboard:!1}),$(target+" .modal-body").load($(this).attr("href")+" #fragment",_improveRepositoryTypeSelection),setTimeout(_populateReloadLocation,600),!1})},_submitModalChanges=function(){var action=function(){var modal=$(".modal.in"),form=modal.find("form");return modal.find(".modal-body").load(form.attr("action")+" #fragment",form.serializeArray(),function(){_improveRepositoryTypeSelection(),_modalSubmitEvents(modal)}),!1};$(document).on("click",".submit-change",action),$(document).on("submit",".modal",action)},_modalSubmitEvents=function(modal){modal.find('button.btn[data-dismiss="modal"]').text("Close"),modal.on("hidden",function(){modal.off("hidden"),modal.find("input[name=reload-location]").val()?location.href=modal.find("input[name=reload-location]").val():location.reload()})},_selectToDropdown=function(){$("select").each(function(i,e){if("no"!=$(e).data("convert")){$(e).hide().wrap('<span class="btn-group" id="select-group-'+i+'" />');var select=$("#select-group-"+i),current=$(e).val()?$(e).find(":selected").text():"&nbsp;";select.html('<input type="hidden" value="'+$(e).val()+'" name="'+$(e).attr("name")+'" id="'+$(e).attr("id")+'" class="'+$(e).attr("class")+'" />'+'<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span>'+current+'</span> <span class="caret"></span></a>'+'<ul class="dropdown-menu"></ul>'),$(e).find("option").each(function(o,q){select.find(".dropdown-menu").append('<li><a href="#" data-value="'+$(q).attr("value")+'">'+$(q).text()+"</a></li>"),$(q).attr("selected")&&select.find(".dropdown-menu li:eq("+o+")").click()}),select.find(".dropdown-menu a").click(function(){return select.find("input[type=hidden]").val($(this).data("value")).change(),select.find(".btn:eq(0) span:eq(0)").text($(this).text()),$(this).parent().parent().parent().removeClass("open"),!1})}})},_navTabs=function(){$("a").on("click",function(){var href=$(this).attr("href");return"#"===href.substr(0,1)&&$(href).hasClass("tab-pane")?($("[href="+href+"]").tab("show"),$(href).parent().hasClass("no-hash")||(location.hash="/"+href.substr(1)),!1):void 0})},_activateTabFromHash=function(){var hash=location.hash.substr(2),hashPieces=hash.split("?"),activeTab=$("[href=#"+hashPieces[0]+"]");activeTab&&activeTab.tab("show")},_improveRepositoryTypeSelection=function(){$("#id_source_repository").parent().append($("#id_repository_type").clone()),$("#div_id_repository_type").remove(),_selectToDropdown()},_newBoxForm=function(){$(".new_box").on("click",function(){$(this).parent().find(".box-list").append($("#tpl_box_form").html()),$(this).remove(),_improveRepositoryTypeSelection()})},_populateReloadLocation=function(){var attrName="data-reload-populate",reloadField=$("input["+attrName+"]");if(reloadField.length){var fieldName=reloadField.attr(attrName),watchedField=reloadField.parent().find("[name="+fieldName+"]"),initialValue=watchedField.val();watchedField.on("change",function(){var value=location.href.replace(initialValue,$(this).val());reloadField.attr("value",value)})}},_addParamChoices=function(){var add_button=$("#add_param");add_button.on("click",function(){return!1}),add_button.popover({placement:"top",html:!0,content:$("#tpl_add_param_choice").html()}),$(document).on("click","#param_type a",function(){return $("#new_param").load(location.pathname+"/param/"+$(this).attr("data-type")+" #fragment",_improveRepositoryTypeSelection),add_button.popover("hide"),add_button.parent().hide(),!1})},_submitParamEdit=function(){$(document).on("click","#configure .save_param",function(){var form=$(this).parent().parent().parent();return form.parent().load(form.attr("action")+" #fragment",form.serializeArray(),_improveRepositoryTypeSelection),!1})},_loadParamEdit=function(){$(".edit-param").on("click",function(){$(this).closest(".parameter").load(location.pathname+"/param/"+$(this).closest(".parameter").attr("data-param")+" #fragment",_selectToDropdown)})},_reloadPage=function(){$(document).on("click",".reload",function(){return location.reload(),!1})},_confirmAction=function(){$(document).on("click",".confirm-action",function(){if(!$(this).hasClass("warmed"))return $(this).addClass("btn-danger").addClass("warmed").val($(this).attr("data-confirm")),!1;var id=$(this).closest(".parameter").attr("data-param");return void 0!==id?$.get(location.pathname+"/param/delete/"+id,function(){location.reload()}):location.reload(),!1})},_modalAsyncCall=function(){$(document).on("click",".modal.in .async-call",function(){return $(".modal-body").load($(this).attr("href")+" #fragment",_improveRepositoryTypeSelection),_modalSubmitEvents($(".modal.in")),!1})};return{init:_init}}();$(document).ready(RBX.init());